---
layout: post
title: "Gradle"
date: 2019-09-16
categories: ["Budowanie"]
image: build/gradle
github: build/tree/master/gradle
description: "Budowanie"
keywords: "budowanie, kompilacja, konfiguracja, build, gradle, apk, properties, configuration, flavor, android, programowanie, programming"
---

## Wstęp
System budowania aplikacji `Android` kompiluje zasoby, kod źródłowy oraz pakiety do pliku w formacie `APK` (`Android Application Package`), który może być testowany, podpisany i dystrybuowany. W tym celu `Android Studio` używa zaawansowanego zestawu narzędzi `Gradle` wraz z dedykowanym `Android Gradle plugin` pozwalających na zarządzanie i automatyzację tego procesu dzięki czemu każda konfiguracja może definiować własne zasady budowania projektu. `Gradle` oraz `plugin` działają niezależnie od `Android Studio` co pozwala na kompilacje bez udziału środowiska programistycznego, np. przez wiersz poleceń.

## Proces
Budowanie aplikacji angażuje wiele narzędzi i uruchamia różne procesy umożliwiające konwersje projektu do `APK`. Typowy proces przebiega następująco. Na początku kompilator konwertuje kod źródłowy do plików `DEX` (`Dalvik Executable`) zawierających kod bajtowy, a pozostałe pliki i zależności do skompilowanych zasobów. Następnie `APK Packager` łączy i optymalizuje pliki `DEX` i skompilowane zasoby do jednego pliku `APK` podpisując go kluczem `debug` lub `release` z `keystore`. Powstały plik `APK` jest gotowy do instalacji, debugowania czy testowania.

## Konfiguracja 
Dokonując konfiguracji budowania projektu można wyróżnić kilka aspektów wpływających na wyjściowy rezultat. `buildTypes` definiuje właściwości dla wydań (np. zaciemnienie release), `productFlavors` reprezentuje różne wersje aplikacji (np. płatna, darmowa, demo) które mogą używać współdzielonych jak i prywatnych zasobów natomiast `buildVariants` jest konkretnym wariantem budowania wynikającym z połączenia wybranych `buildTypes` i `productFlavors`. Wartości wpisów w `AndroidManifest` mogą się różnić w zależności od wariantu budowania (np. inna nazwa czy różne minSdk). System budowania zarządza także wpisami lokalnych i zdalnych zależności `dependencies` dzięki czemu nie ma potrzeby ręcznego szukania, pobierania i kopiowania pakietów zależności do projektu. Ponadto umożliwia ustawienie podpisu autentykacyjnego i zasad bezpieczeństwa `ProGuard` oraz wspiera budowanie wielu `APK`.

## Pliki
Informacje nt konfiguracji znajdują sie w kilku plikach projektu. Używają one `DSL` (`Domain Specific Language`) do opisania i manipulowania logiką przy pomocy `Groovy` (dynamicznego języka dla `JVM`). `Android Gradle plugin` dostarcza większość potrzebnych elementów `DSL` w związku z czym nie jest wymagana wiedza programowania w `Groovy`. Kod źródłowy i zasoby powinny być logicznie pogrupowane zgodnie z przynależnością do modułu, tzn. kod oraz zasoby znajdujące się w `src/main` są współdzielone przez wszystkie warianty kompilacji, natomiast np. `src/debug` tylko dla wariantu debug.  
  
`settings.gradle` deklaruje moduły, które powinny wziąć udział w procesie budowania projektu

//TODO

`build.gradle` znajdujący się w głównym katalogu definuje konfigurację wspólną dla wszystkich modułów w projekcie

//TODO

`build.gradle` znajdujący się w każdym module pozwala na specyficzną konfiguracje dla danego modułu uzupełniając lub nadpisując definicję `build.gradle` projektu 

//TODO

`gradle.properties` określa ustawienia Gradle dla całego projektu, takie jak np. maksymalna wielkość stosu demona Gradle

//TODO

`local.properties` konfiguruje lokalne właściwości środowiska dla systemu kompilacji, takie jak np. ścieżka instalacji SDK

//TODO