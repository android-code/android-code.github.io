---
layout: post
title: "MVP"
date:  2018-10-29
categories: ["Wzorce projektowe"]
image: patterns/mvp
github: design-patterns/tree/master/mvp
description: "Wzorce projektowe / architektoniczny"
keywords: "mvp, model, view, preseneter, interactor, wzorzec, wzorce projektowe, wzorzec architektoniczny, design patterns, android, java, programowanie, programming"
---

## Zastosowanie
`MVP` (ang. `MVP`) (wzorzec architektoniczny)
TODO

## Ograniczenia
TODO

## Użycie
TODO

## Implementacja
TODO

![MVP diagram](/assets/img/diagrams/patterns/mvp.svg){: .center-image }

TODO

{% highlight java %}
public class ViewImpl implements View {
    //this class is in charge and initialize everything so in Android it could be Activity  
    //for simplify MVP idea any Android class is used

    //some view fields like buttons, textview etc
    private TextView textView;
    private EditText editText;
    private Button button;

    private Presenter presenter;

    //for Activity, Fragment, Custom view or other View layer
    //initialize view and presenter in lifecycle methods
    public ViewImpl() {
        initView();
        initPresenter();
        initListeners();
    }

    private void initView() {
        //set default text/image etc in the views
    }

    private void initListeners() {
        button.setOnClickListener(v -> {
            String input = editText.getText().toString();
            presenter.onButtonClicked(input)
        });
    }

    private void initPresenter() {
        //in some variants Model object layer could be injected to presenter also
        this.presenter = new Presenter(this);    
    }

    @Override
    public void updateText(String text) {
        textView.setText(text);
        //show response text in the textView
    }

    @Override
    public void showError(String error) {
        //show error on the screen (in Android like Toast)
    }

    @Override
    public void showProgress(boolean enable) {
        if(enable) {
            //show progress bar
        }
        else {
            //hide progress bar
        }      
    }
}

public class Presenter {

    private View view;
    private Model model;

    public Presenter(View view) {
        this.view = view;
        this.model = model; //can be injected by the View
    }

    @Override
    public void onButtonClicked(String input) {
        //do proper action
        view.showProgress(true);
        String response = model.insertTask(input);

        if(response.equals("EMPTY")) {
          view.showProgress(false);      
          view.showError();
        }
        else {
          view.showProgress(false);      
          view.updateText(response);
        }
    }
}

public class Model {

    private Database database;
    //other variables, logic managers or data providers like database, cache, network

    public Model() {
        //do init staff
        //initialize some instances
        database = new Database();
    }

    public String insertTask(String input) {
        boolean isSuccess = database.add("TASK", input);
        if(isSuccess)
          return getTasks();
        else
          return "EMPTY";
    }

    private String getTasks() {
        String tasks = "";
        for(int i=0; i<database.size("TASK"); i++)
            tasks += database.get("TASK", i) + "\n";
        return tasks;
    }
}

interface View {
    
    void updateText(String text);
    void showError(String error);
    void showProgress(boolean enable);
}
{% endhighlight %}

## Przykład
TODO

{% highlight java %}
public class ViewActivity extends AppCompatActivity implements View {

    private EditText loginEdit;
    private EditText passwordEdit;
    private Button loginButton;

    private Presenter presenter;

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.view_activity);
        presenter = new PresenterImpl(this);

        initView();
        setListeners();
        setViews();
    }

    //other lifecycle methods

    private void initView() {
        loginEdit = findViewById(R.id.loginEdit);
        passwordEdit = findViewById(R.id.passwordEdit);
        loginButton = findViewById(R.id.loginButton);
    }

    private void setListeners() {
        loginButton.setOnClickListener(v -> { loginAction(); });
    }

    private void setViews() {
        presenter.initView();
    }

    @Override
    public void showError() {
        Toast.makeText(this, "Incorrect login or password", Toast.LENGTH_LONG).show();
    }

    @Override
    public void showInvalidLoginError(boolean enable) {
        if(enable) {
            //show invalid login error
        }
        else {
            //clear error
        }
    }

    @Override
    public void showInvalidPasswordError(boolean enable) {
        if(enable) {
            //show invalid password error
        }
        else {
            //clear error
        }
    }

    @Override
    public void navigateToHome() {
        //go to another activity (like home screen)
        //instead of doing logic operations it can be delegate to Router helper class
    }

    private void loginAction() {
        //controller get inputs from view
        String login = loginEdit.getText().toString();
        String password = passwordEdit.getText().toString();
        presenter.loginButtonClicked(login, password);
    }
}

public class PresenterImpl implements Presenter, OnResult {

    private View view;
    private Interactor interactor;

    public PresenterImpl(View view) {
        this.view = view;
        this.interactor = new InteractorImpl(this); //can be injected by the View
    }

    @Override
    public void loginButtonClicked(String login, String password) {
        //validate login and password based on rules
        if(isLoginValid(login)) {
            view.showInvalidLoginError(false);
            
            if(isPasswordValid(password)) {
                view.showInvalidPasswordError(false);
                interactor.login(login, password);
            }
            else
                view.showInvalidPasswordError(true);
        }
        else
            view.showValidLoginError(true);
    }

    @Override
    public void initView() {
        interactor.getSavedLogin();
    }

    private boolean isLoginValid(String login) {
        //check rules e.g. no special characters
        return true; //mock
    }

    private boolean isPasswordValid(String password) {
        //check rules e.g. length
        return true; //mock
    }
}

public class InteractorImpl implements Interactor {

    //some network provider
    private SharedPreferences sharedPref;
    private SharedPreferences.Editor editor;
    private Context context;

    private OnResult listener;

    public InteractorImpl(OnResult listener) {
        this.listener = listener;
        this.context = App.getContext();
        sharedPref = context.getPreferences(Context.MODE_PRIVATE);
    }

    public void login(String login, String password) {
        //use some network library to login
        int code = Response.OK; //mock code response from network

        if(code == Response.OK) {
            saveLogin(login);
            listener.onLoginSuccess();
        }
        else {
            listener.onLoginFail();
        }
    }

    public void getSavedLogin() {
        String savedLogin = sharedPref.getString("login", "");
        if(!savedLogin.equals(""))
            listener.onSavedLoginExists(savedLogin);
    }

    private void saveLogin(String login) {
        editor = sharedPref.edit();
        editor.putString("login", login);
        editor.commit();
    }
}

interface Contract {

    interface View {

        void navigateToHome();
        void showError();
        void showInvalidLogin(boolean valid);
        void showInvalidPassword(boolean valid);
    }

    interface Presenter {

        void initView();
        void loginButtonClicked(String login, String password);
    }
}

interface Interactor {

    void getSavedLogin(); 
    void login(String login, String password);

    interface OnResult {

        void onLoginSuccess();
        void onLoginFail();
        void onSavedLoginExists(String savedLogin);
    }
}
{% endhighlight %}

## Biblioteki
TODO
