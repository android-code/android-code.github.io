---
layout: post
title: "Pyłek"
date:  2018-09-24
categories: ["Wzorce projektowe"]
image: flyweight
github: flyweight
description: "Wzorce projektowe / strukturalny"
keywords: "pyłek, flyweight, wzorzec, wzorce projektowe, wzorzec strukturalny, design patterns, android, java, programowanie, programming"
---

## Zastosowanie
`Pyłek` (ang. `Flyweight`) (wzorzec strukturalny)
TODO

## Ograniczenia
TODO

## Użycie
TODO

## Implementacja
TODO

![Pyłek diagram](/assets/img/diagrams/flyweight.svg){: .center-image }

TODO

{% highlight java %}
public class FlyweightFactor {

    //if there are more types of flyweight classes than use Factory method

    public static Map<String, Flyweight> flyweightTypes = new HashMap<>();

    public static Flyweight getFlyweight(String type, int value) {
        Flyweight flyweight = flyweightTypes.get(type);
        if(result == null) {
            result = new ConcreteFlyweight(name, value);
            flyweightTypes.put(name, result);
        }
        else {
            result.setValue(value);
        }
        return result;
    }
}

public class ConcreteFlyweight implements Flyweight {

    private String type;
    private int value;

    public Flyweight1(String type, int value) {
        //creation of object is consuming resources
        this.type = type;
        this.value = value;
    }

    @Override
    public void operation() {
        //do specific operation for ConcreteFlyweight
    }

    public void setValue(int value) {
        this.value = value;
    }

    //other setters and getters
}

//implement more concrete flyweight's classes if needed

//interface can by replaced by abstract class if more common classes exist
interface Flyweight {

    void operation();
}
{% endhighlight %}

TODO

{% highlight java %}
//3 types of items can be created so reuse those items instead of creation new one
String types[] = { "Type1", "Type2", "Type3" };

//generate a lot of items for example in loop with random values
for(int i=0; i<100; i++) {
    //get random type and value
    String type = randomType(types);
    value = randomValue(0, 100);
    //get flyweight item from factory and do operation
    Flyweight flyweight = FlyweightFactory.getFlyweight(type, value);
    flyweight.operation();
}
//factory created only 3 items: Type1, Type2, Type3 and rest of 97 have been reused
{% endhighlight %}

## Przykład
TODO

{% highlight java %}
public class PlantFactory {

    private static Map<Type, Plant> types  = new HashMap<>();

    public static Details getPlantDetails(Type type) {
        Details item = types.get(type);
        if(item == null) {
            item = new Details(type);
            types.put(type, item);
        }
        return item;
    }
}

public class Tree extends Plant {

	@Override
    public void draw() {
        //draw concrete type of the tree in the point in specific way
    }
}

public class Flower extends Plant {

	@Override
    public void draw() {
        //draw concrete type of the flower in the point in specific way
    }
}

public class Details {

    private Type type;
    private Texture texture;
    private String data;

    public Details(Type type) {
        this.type = type;
        loadTexture();
        loadData();
        this.texture = texture;
        this.data = data;
    }

    private void loadTexture() {
        //load texture based on the type
    }

    private void loadData() {
        //load additional data based on the type
    }

    //some methods
}

public abstract class Plant {
	
	private Point point;
    private Data data;

    public Plant(Point point, Data data) {
        this.point = point;
        this.data = data;
    }

    public abstract void draw();
}
{% endhighlight %}

TODO

{% highlight java %}
//user start new game so the board is creating
//a lot of trees are in the board, so create all types of the tree and reuse them

for(int i=0; i<1000; i++) {
    //random position of the tree on the board
    int x = 10; //only mock
    int y = 20;
    int z = 5;
    Position position = new Position(x, y, z);

    //random type of the plant and get it from cache factory
    Type type = randomType();
    Details details = TreeFactory.getTreeType(type);
    Plant plant;

    //Factory method can be used, but for simplify just if-else
    if(type == Type.OAK || type == Type.PINE || Type.CHESTNUT) {
    	plant = new Tree(point, data);
    }
    else if(type == Type.ROSE || Type.TULIP || Type.HEATHER) {
    	plant = new Flower(point, data);
    }
    
    //put the plant on the map
    plant.draw();
}
{% endhighlight %}

## Biblioteki
TODO